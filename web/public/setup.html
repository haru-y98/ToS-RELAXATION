<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ToS Relaxation - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      margin-bottom: 10px;
    }
    button:hover {
      background: #1d4ed8;
    }
    button:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }
    .log {
      background: #1e293b;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 14px;
      max-height: 400px;
      overflow-y: auto;
    }
    .log-item {
      margin-bottom: 8px;
      padding: 4px 0;
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
    .info { color: #3b82f6; }
    .warning { color: #f59e0b; }
    .step {
      background: #f8fafc;
      padding: 15px;
      border-left: 4px solid #2563eb;
      margin: 15px 0;
    }
    .step-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ ToS Relaxation ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</h1>
    <p class="subtitle">ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ã¾ã™</p>

    <div class="step">
      <div class="step-title">ã‚¹ãƒ†ãƒƒãƒ— 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</div>
      <p>ã“ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€Supabaseã«ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚</p>
      <button id="setupBtn" onclick="setupDatabase()">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</button>
    </div>

    <div class="step">
      <div class="step-title">ã‚¹ãƒ†ãƒƒãƒ— 2: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª</div>
      <p>ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã€ä»¥ä¸‹ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ï¼š</p>
      <p><a href="http://localhost:3000" target="_blank" style="color: #2563eb; font-weight: bold;">http://localhost:3000</a></p>
    </div>

    <div id="log" class="log" style="display: none;"></div>
  </div>

  <script>
    const SUPABASE_URL = 'https://isduqadpcgirxhejhyzw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzZHVxYWRwY2dpcnhoZWpoeXp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1MTgzNTgsImV4cCI6MjA4MTA5NDM1OH0.EWoe-DvWq5Xt52feTxtqG7hTxeBT6uFU6d8IANde67s';

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      logDiv.style.display = 'block';
      const item = document.createElement('div');
      item.className = `log-item ${type}`;
      item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(item);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    async function setupDatabase() {
      const btn = document.getElementById('setupBtn');
      btn.disabled = true;
      btn.textContent = 'ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­...';

      try {
        log('ğŸš€ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™', 'info');

        // ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿
        log('ğŸ“ ãƒ¡ãƒ³ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ä¸­...', 'info');
        const members = [
          {
            name: 'å¤ªéƒ',
            age: 28,
            height: 175,
            weight: 75,
            residence: 'æ±äº¬éƒ½æ¸‹è°·åŒº',
            dispatch_status: 'ã©ã¡ã‚‰ã‚‚å¯èƒ½',
            qualification: 'å›½å®¶è³‡æ ¼æ‰€æœ‰',
            appeal_comment: 'çµŒé¨“10å¹´ä»¥ä¸Šã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§ã™ã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹ç©ºé–“ã‚’ã”æä¾›ã—ã¾ã™ã€‚',
            internal_status: 'NEW',
            display_order: 1,
            is_active: true
          },
          {
            name: 'æ¬¡éƒ',
            age: 32,
            height: 180,
            weight: 80,
            residence: 'æ±äº¬éƒ½æ–°å®¿åŒº',
            dispatch_status: 'å‡ºå¼µå¯',
            qualification: 'æ°‘é–“è³‡æ ¼æ‰€æœ‰',
            appeal_comment: 'ä¸å¯§ãªæ–½è¡“ã‚’å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚ãŠå®¢æ§˜ã®æ‚©ã¿ã«å¯„ã‚Šæ·»ã„ã¾ã™ã€‚',
            internal_status: 'äººæ°—',
            display_order: 2,
            is_active: true
          },
          {
            name: 'ä¸‰éƒ',
            age: 25,
            height: 170,
            weight: 68,
            residence: 'æ±äº¬éƒ½ä¸–ç”°è°·åŒº',
            dispatch_status: 'å ´æ‰€æœ‰',
            qualification: 'ãªã—',
            appeal_comment: 'è‹¥æ‰‹ã§ã™ãŒæŠ€è¡“ã«ã¯è‡ªä¿¡ãŒã‚ã‚Šã¾ã™ã€‚ãŠæ°—è»½ã«ãŠè©¦ã—ãã ã•ã„ã€‚',
            internal_status: 'é€šå¸¸',
            display_order: 3,
            is_active: true
          }
        ];

        const { data: insertedMembers, error: membersError } = await supabaseClient
          .from('members')
          .insert(members)
          .select();

        if (membersError) {
          if (membersError.code === 'PGRST205') {
            log('âŒ ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚SETUP_GUIDE.mdã®æ‰‹é †ã«å¾“ã£ã¦Supabaseã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚', 'error');
            log('ğŸ“– https://app.supabase.com/project/isduqadpcgirxhejhyzw/sql/new ã‚’é–‹ã„ã¦ schema.sql ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„', 'warning');
            btn.disabled = false;
            btn.textContent = 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—';
            return;
          }
          throw membersError;
        }

        log(`âœ… ãƒ¡ãƒ³ãƒãƒ¼ã‚’ ${insertedMembers.length} ä»¶è¿½åŠ ã—ã¾ã—ãŸ`, 'success');

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿
        log('ğŸ“ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ä¸­...', 'info');
        const menus = [
          // å¤ªéƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼
          {
            member_id: insertedMembers[0].id,
            service_name: '60åˆ†åŸºæœ¬ã‚³ãƒ¼ã‚¹',
            duration_minutes: 60,
            price: 8000,
            description: 'å…¨èº«ã‚’ã»ãã™åŸºæœ¬çš„ãªãƒãƒƒã‚µãƒ¼ã‚¸ã‚³ãƒ¼ã‚¹ã§ã™',
            is_available: true
          },
          {
            member_id: insertedMembers[0].id,
            service_name: '90åˆ†ã—ã£ã‹ã‚Šã‚³ãƒ¼ã‚¹',
            duration_minutes: 90,
            price: 12000,
            description: 'ã˜ã£ãã‚Šæ™‚é–“ã‚’ã‹ã‘ã¦å…¨èº«ã‚’ä¸å¯§ã«ã»ãã—ã¾ã™',
            is_available: true
          },
          {
            member_id: insertedMembers[0].id,
            service_name: '120åˆ†ã‚¹ãƒšã‚·ãƒ£ãƒ«ã‚³ãƒ¼ã‚¹',
            duration_minutes: 120,
            price: 15000,
            description: 'æœ€é«˜ã®ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ä½“é¨“ã‚’ãŠå±Šã‘ã—ã¾ã™',
            is_available: true
          },
          // æ¬¡éƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼
          {
            member_id: insertedMembers[1].id,
            service_name: '60åˆ†ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚³ãƒ¼ã‚¹',
            duration_minutes: 60,
            price: 9000,
            description: 'ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆã«æœ€é©ãªã‚³ãƒ¼ã‚¹ã§ã™',
            is_available: true
          },
          {
            member_id: insertedMembers[1].id,
            service_name: '90åˆ†ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ¼ã‚¹',
            duration_minutes: 90,
            price: 13000,
            description: 'ä¸Šè³ªãªæ™‚é–“ã‚’ãŠéã”ã—ã„ãŸã ã‘ã¾ã™',
            is_available: true
          },
          // ä¸‰éƒã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼
          {
            member_id: insertedMembers[2].id,
            service_name: '60åˆ†ãŠè©¦ã—ã‚³ãƒ¼ã‚¹',
            duration_minutes: 60,
            price: 7000,
            description: 'ã¯ã˜ã‚ã¦ã®æ–¹ã«ãŠã™ã™ã‚ã®ã‚³ãƒ¼ã‚¹ã§ã™',
            is_available: true
          },
          {
            member_id: insertedMembers[2].id,
            service_name: '90åˆ†ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚³ãƒ¼ã‚¹',
            duration_minutes: 90,
            price: 10000,
            description: 'ç–²ã‚Œã‚’ç™’ã‚„ã™ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚³ãƒ¼ã‚¹ã§ã™',
            is_available: true
          }
        ];

        const { data: insertedMenus, error: menusError } = await supabaseClient
          .from('menus')
          .insert(menus)
          .select();

        if (menusError) throw menusError;

        log(`âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ ${insertedMenus.length} ä»¶è¿½åŠ ã—ã¾ã—ãŸ`, 'success');

        // å–¶æ¥­æ™‚é–“ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¬¡ã®30æ—¥é–“ï¼‰
        log('ğŸ“ å–¶æ¥­æ™‚é–“ã‚’è¨­å®šä¸­...', 'info');
        const availabilities = [];
        for (let i = 0; i < 30; i++) {
          const date = new Date();
          date.setDate(date.getDate() + i);
          const dateStr = date.toISOString().split('T')[0];

          for (const member of insertedMembers) {
            availabilities.push({
              member_id: member.id,
              date: dateStr,
              start_time: '10:00',
              end_time: '22:00',
              is_available: true
            });
          }
        }

        const { data: insertedAvailability, error: availabilityError } = await supabaseClient
          .from('member_availability')
          .insert(availabilities)
          .select();

        if (availabilityError) throw availabilityError;

        log(`âœ… å–¶æ¥­æ™‚é–“ã‚’ ${insertedAvailability.length} ä»¶è¿½åŠ ã—ã¾ã—ãŸ`, 'success');

        log('ğŸ‰ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ!', 'success');
        log('', 'info');
        log('ğŸ“Š è¿½åŠ ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:', 'info');
        log(`  - ãƒ¡ãƒ³ãƒãƒ¼: ${insertedMembers.length} äºº`, 'info');
        log(`  - ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ${insertedMenus.length} ä»¶`, 'info');
        log(`  - å–¶æ¥­æ™‚é–“: ${insertedAvailability.length} ä»¶`, 'info');
        log('', 'info');
        log('âœ¨ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„!', 'success');

        btn.textContent = 'ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼';
        btn.style.background = '#10b981';

      } catch (error) {
        log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
        console.error('Setup error:', error);
        btn.disabled = false;
        btn.textContent = 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—';
      }
    }
  </script>
</body>
</html>
